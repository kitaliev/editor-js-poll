{"version":3,"file":"index.js","sources":["../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.js"],"sourcesContent":["var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import \"./index.styl\"\n\nexport default class Poll {\n  rootClass = 'editor-js-poll-plugin';\n\n  constructor({data, api, block }){\n    this.data = data;\n    this.api = api;\n    this.blockAPI = block;\n  }\n\n  render(){\n    this.root = document.createElement('div');\n    this.root.classList.add(this.rootClass);\n    this.root.classList.add('cdx-block');\n    this.root.innerHTML = `<div class=\"${this.rootClass}__header\">\n      <input class=\"${this.rootClass}__input cdx-input\" placeholder=\"Вопрос\" type=\"text\" />\n      <div class=\"${this.rootClass}__header-checks\">\n        <label class=\"${this.rootClass}__checkbox\" title=\"Пользователь может выбрать несколько правильных ответов\">\n          <input type=\"checkbox\">\n          <span>Несколько ответов</span>\n        </label>\n        <label class=\"${this.rootClass}__checkbox\" title=\"Опрос с правильными и неправильными ответами\">\n          <input type=\"checkbox\">\n          <span>Викторина</span>\n        </label>\n      </div>\n    </div>\n    <div class=\"${this.rootClass}__body\"></div>`;\n    // Вопрос\n    if (this.data) {\n      this.root.querySelector(`.${this.rootClass}__header .${this.rootClass}__input`).value = this.data.question || '';\n    }\n\n    // Несколько ответов\n    let multipleAnswersCheckbox = this.root.querySelector(`.${this.rootClass}__header .${this.rootClass}__checkbox:first-child input`);\n    // Смена типа чекбокса ответа\n    this.api.listeners.on(multipleAnswersCheckbox, 'change', (e) => {\n      this.root.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__checkbox input`).forEach((input) => {\n        input.setAttribute('type', e.target.checked ? 'checkbox' : 'radio')\n      });\n      this.data.multiple = e.target.checked;\n    })\n    if (this.data) {\n      // Вставка из data\n      multipleAnswersCheckbox.checked = this.data.multiple;\n    }\n\n    // Викторина\n    let quizCheckbox = this.root.querySelector(`.${this.rootClass}__header .${this.rootClass}__checkbox:last-child input`);\n    // Вставка из data\n    if (this.data.quiz) {\n      quizCheckbox.checked = this.data.quiz\n    }\n\n    this.api.listeners.on(quizCheckbox, 'change', (e) => {\n      this.data.quiz = e.target.checked;\n      this.root.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__checkbox`).forEach((input) => {\n        input.setAttribute('type', multipleAnswersCheckbox.checked ? 'checkbox' : 'radio');\n        if (!e.target.checked) {\n          input.classList.add(`${this.rootClass}__hidden`)\n        } else {\n          input.classList.remove(`${this.rootClass}__hidden`)\n        }\n      });\n    })\n\n    // Ответы\n    // Вставка ответов из data\n    if (this.data && this.data.answers) {\n      this.data.answers.forEach((answer) => {\n        if (answer.value.trim().length) {\n          this.root.querySelector(`.${this.rootClass}__body`).append(this.getAnswer(answer.value, answer.checked));\n        }\n      })\n    }\n    // Если нет ни одного ответа вставляем пустой\n    if (!(this.data && this.data.answers && this.data.answers.length && this.data.answers.reduce((a, b) => a + !b.value.trim().length ? 1 : 0, 0).length)) {\n      this.root.querySelector(`.${this.rootClass}__body`).appendChild(this.getAnswer());\n    }\n\n    // Слушатели полей ввода ответа\n    this.root.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__answer`).forEach((input) => {\n      // Чекбокс\n      this.api.listeners.on(input.querySelector(`.${this.rootClass}__checkbox input`), 'change', () => {\n        this.blockAPI.dispatchChange()\n      }, false);\n      // Input\n      this.api.listeners.on(input.querySelector(`.${this.rootClass}__input`), 'input', () => {\n        this.handleAnswerInput()\n      }, false);\n    })\n    return this.root;\n  }\n\n  save(blockContent){\n    let answers = Array.from(blockContent.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__answer`)).map((node) => ({\n      value: node.querySelector(`.${this.rootClass}__input`).value,\n      checked: node.querySelector(`.${this.rootClass}__checkbox input`).checked || false,\n    }));\n    answers = answers.filter(a => !!a.value.trim().length);\n    return {\n      question: blockContent.querySelector(`.${this.rootClass}__header .${this.rootClass}__input`).value,\n      multiple: blockContent.querySelector(`.${this.rootClass}__header .${this.rootClass}__checkbox:first-child input`).checked || false,\n      quiz: blockContent.querySelector(`.${this.rootClass}__header .${this.rootClass}__checkbox:last-child input`).checked || false,\n      answers: answers,\n    };\n  }\n\n  handleAnswerInput() {\n    this.root.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__input`).forEach((input) => {\n      if (!input.value.trim().length) {\n        input.parentNode.remove()\n      }\n    })\n    let inputs = Array.from(this.root.querySelectorAll(`.${this.rootClass}__body .${this.rootClass}__input`));\n    let emptyInputs = inputs.reduce((a, b) => a + !b.value.trim().length ? 1 : 0, 0);\n    if (!emptyInputs) {\n      let input = this.getAnswer();\n      this.api.listeners.on(input.querySelector(`.${this.rootClass}__input`), 'input', () => {\n        this.handleAnswerInput()\n      }, false);\n      this.api.listeners.on(input.querySelector(`.${this.rootClass}__checkbox input`), 'input', () => {}, false);\n      this.root.querySelector(`.${this.rootClass}__body`).appendChild(input);\n    }\n  }\n\n  getAnswer(value, checked) {\n    let root = document.createElement('div');\n    root.classList.add(`${this.rootClass}__answer`);\n    root.innerHTML = `<label class=\"${this.rootClass}__checkbox ${!this.data.quiz ? `${this.rootClass}__hidden` : ''}\" title=\"Правильный ответ\"><input name=\"${this.blockAPI?.id || ''}\" type=\"${this.data.multiple ? 'checkbox' : 'radio'}\"></label>\n      <input type=\"text\" class=\"${this.rootClass}__input cdx-input\" placeholder=\"Вариант ответа\" />`;\n    root.querySelector(`.${this.rootClass}__checkbox input`).checked = checked || false;\n    root.querySelector(`.${this.rootClass}__input`).value = value || '';\n    return root;\n  }\n\n  static get toolbox() {\n    return {\n      title: 'Опрос',\n      icon: '<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M21 22.75H3C2.59 22.75 2.25 22.41 2.25 22C2.25 21.59 2.59 21.25 3 21.25H21C21.41 21.25 21.75 21.59 21.75 22C21.75 22.41 21.41 22.75 21 22.75Z\" fill=\"#292D32\"/><path d=\"M5.6 8.38H4C3.45 8.38 3 8.83 3 9.38V18C3 18.55 3.45 19 4 19H5.6C6.15 19 6.6 18.55 6.6 18V9.38C6.6 8.82 6.15 8.38 5.6 8.38Z\" fill=\"#292D32\"/><path d=\"M12.8002 5.18994H11.2002C10.6502 5.18994 10.2002 5.63994 10.2002 6.18994V17.9999C10.2002 18.5499 10.6502 18.9999 11.2002 18.9999H12.8002C13.3502 18.9999 13.8002 18.5499 13.8002 17.9999V6.18994C13.8002 5.63994 13.3502 5.18994 12.8002 5.18994Z\" fill=\"#292D32\"/><path d=\"M19.9999 2H18.3999C17.8499 2 17.3999 2.45 17.3999 3V18C17.3999 18.55 17.8499 19 18.3999 19H19.9999C20.5499 19 20.9999 18.55 20.9999 18V3C20.9999 2.45 20.5499 2 19.9999 2Z\" fill=\"#292D32\"/></svg>'\n    };\n  }\n}"],"names":["e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","Object","keys","length","insertAdjacentElement","Poll","rootClass","constructor","data","api","block","this","blockAPI","render","root","classList","add","innerHTML","value","question","multipleAnswersCheckbox","listeners","on","querySelectorAll","forEach","input","target","checked","multiple","quizCheckbox","quiz","remove","answers","answer","trim","append","getAnswer","reduce","b","dispatchChange","handleAnswerInput","save","blockContent","Array","from","map","node","filter","parentNode","id","toolbox","title","icon"],"mappings":"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"}